<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>내 위치 찾기 개선 지도</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    #map {
      width: 100%;
      height: 100vh;
    }

    .button {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      cursor: pointer;
    }
  </style>
  <script defer src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=abf50f881fbafdf6787347059a09b69c&autoload=false"></script>
  <script>
    let map;
    let myLocationMarker = null;

    window.onload = function () {
      kakao.maps.load(function () {
        const container = document.getElementById('map');
        const options = {
          center: new kakao.maps.LatLng(37.5665, 126.9780), // 초기 위치 (서울)
          level: 5
        };
        map = new kakao.maps.Map(container, options);
        // ✅ 여기에 기존 마커 등록 코드 넣기
      });
    };

    function findMyLocation() {
      if (!navigator.geolocation) {
        alert("이 브라우저에서는 위치 정보가 지원되지 않습니다.");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        function (position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const accuracy = position.coords.accuracy;

          console.log("📍 위도: " + lat);
          console.log("📍 경도: " + lng);
          console.log("📏 정확도: " + accuracy + "m");

          const locPosition = new kakao.maps.LatLng(lat, lng);

          if (myLocationMarker) {
            myLocationMarker.setMap(null);
          }

          const marker = new kakao.maps.Marker({
            position: locPosition,
            image: new kakao.maps.MarkerImage(
              "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png",
              new kakao.maps.Size(30, 45)
            )
          });
          marker.setMap(map);
          myLocationMarker = marker;

          map.setLevel(3);
          map.panTo(locPosition);
        },
        function (error) {
          console.error("위치 정보 오류:", error);
          switch (error.code) {
            case error.PERMISSION_DENIED:
              alert("위치 접근이 차단되었습니다. 브라우저 위치 권한을 확인하세요.");
              break;
            case error.POSITION_UNAVAILABLE:
              alert("위치 정보를 확인할 수 없습니다.");
              break;
            case error.TIMEOUT:
              alert("위치 정보를 가져오는 데 시간이 초과되었습니다.");
              break;
            default:
              alert("알 수 없는 오류가 발생했습니다.");
          }
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }
  </script>
</head>
<body>
  <div class="button" onclick="findMyLocation()">📍 내 위치 찾기</div>
  <div id="map"></div>
</body>
</html>
