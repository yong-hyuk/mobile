<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>업무 지점 지도</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=abf50f881fbafdf6787347059a09b69c&autoload=true"></script>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
    #map { width: 100%; height: 100%; }
    .marker-label {
      font-size: 14px;
      background: white;
      padding: 4px 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    const locations = [
      { id: 1, lat: 37.5665, lng: 126.9780, title: "서울 시청", completed: false },
      { id: 2, lat: 37.5700, lng: 126.9769, title: "광화문", completed: false },
      { id: 3, lat: 37.5723, lng: 126.9812, title: "경복궁", completed: false }
    ];

    let map;
    let markers = [];

    function createMarkerImage(completed) {
      const imageSrc = completed
        ? "http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_green.png"
        : "http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png";
      return new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(24, 35));
    }

    function drawMarkers() {
      markers.forEach(m => m.setMap(null));
      markers = [];

      locations.forEach(loc => {
        const marker = new kakao.maps.Marker({
          map: map,
          position: new kakao.maps.LatLng(loc.lat, loc.lng),
          title: loc.title,
          image: createMarkerImage(loc.completed)
        });

        const content = `
          <div class="marker-label">
            <strong>${loc.title}</strong><br/>
            <label>
              <input type="checkbox" onclick="handleCheckboxClick(${loc.id}, this)" ${loc.completed ? 'checked disabled' : ''}/> 완료
            </label>
          </div>
        `;

        const infowindow = new kakao.maps.InfoWindow({
          content: content
        });

        kakao.maps.event.addListener(marker, 'click', () => {
          infowindow.open(map, marker);
        });

        markers.push(marker);
      });
    }

    window.handleCheckboxClick = function(id, checkbox) {
      if (!checkbox.checked) return;

      const loc = locations.find(l => l.id === id);
      loc.completed = true;

      drawMarkers();
      moveToNextIncomplete();
    }

    function moveToNextIncomplete() {
      const next = locations.find(l => !l.completed);
      if (next) {
        const moveLatLon = new kakao.maps.LatLng(next.lat, next.lng);
        map.panTo(moveLatLon);
      } else {
        alert("🎉 모든 지점을 완료했습니다!");
      }
    }

    kakao.maps.load(function () {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(locations[0].lat, locations[0].lng),
        level: 4
      };
      map = new kakao.maps.Map(container, options);
      drawMarkers();
    });
  </script>
</body>
</html>
