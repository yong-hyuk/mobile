<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>모바일 최적화 지도</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=abf50f881fbafdf6787347059a09b69c&autoload=true"></script>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
    #map { width: 100%; height: 100%; }
    #locateBtn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 10;
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <button id="locateBtn" onclick="goToMyLocation()">내 위치</button>

  <script>
    let map, myLocation;
    const completed = {};

    const markerData = [
{ lat 37.3241820391565, lng 129.263671429562, title 영남 동해선17-1(포삼)_강원도 삼척시 근덕면 궁촌리 산76-7 },
{ lat 37.3389729, lng 129.2454184, title 영남 동해선17-2(포삼)_강원도 삼척시 근덕면 동막리 산 88 },
{ lat 37.3449888971359, lng 129.237951875139, title 영남 동해선17-3(포삼)_강원도 삼척시 근덕면 동막리 산587-4 },
{ lat 37.34827362, lng 129.2357483, title 영남 동해선17-4(포삼)_강원도 삼척시 근덕면 동막리 915-1 },
{ lat 37.349107624683, lng 129.233299468898, title 영남 동해선17-5(포삼)_강원도 삼척시 근덕면 광태리 산159-3 },
{ lat 37.35428643, lng 129.2279111, title 영남 동해선17-6(포삼)_강원도 삼척시 근덕면 광태리 273-1 },
{ lat 37.3832942582047, lng 129.216012976991, title 영남 동해선17-7(포삼)_강원도 삼척시 근덕면 하맹방리 산 186 },
{ lat 37.38816375, lng 129.2124715, title 영남 동해선17-8(포삼)_강원도 삼척시 근덕면 하맹방리 산 38 },
{ lat 37.39103703, lng 129.2107839, title 영남 동해선17-9(포삼)_강원도 삼척시 근덕면 상맹방리 산 113 },
{ lat 37.3963922, lng 129.2081888, title 영남 동해선17-10(포삼)_강원도 삼척시 근덕면 상맹방리 산 98 },
{ lat 37.4008775980085, lng 129.204955550579, title 영남 동해선17-11(포삼)_강원도 삼척시 근덕면 상맹방리 산75-1 },
{ lat 37.43100852, lng 129.1741177, title 영남 동해선17-12(포삼)_강원도 삼척시 사직동 216-24 }
    ];

    kakao.maps.load(() => {
      map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(markerData[0].lat, markerData[0].lng),
        level: 8
      });

      map.setMapTypeId(kakao.maps.MapTypeId.SKYVIEW);

      const bounds = new kakao.maps.LatLngBounds();
      const markers = [];

      markerData.forEach((data, idx) => {
        const pos = new kakao.maps.LatLng(data.lat, data.lng);
        const marker = new kakao.maps.Marker({
          position: pos,
          title: data.title,
          map: map,
          image: createMarkerImage(false)
        });

        marker.idx = idx;

        const infowindow = new kakao.maps.InfoWindow({
          content: `
            <div style="padding:5px;font-size:13px;">
              ${data.title}<br/>
              <label><input type="checkbox" onclick="markComplete(${idx}, this)"> 완료</label>
            </div>
          `
        });

        kakao.maps.event.addListener(marker, 'click', () => {
          infowindow.open(map, marker);
        });

        markers.push(marker);
        bounds.extend(pos);
      });

      map.setBounds(bounds);
      window.markers = markers;
    });

    function createMarkerImage(isComplete) {
      const imageSrc = isComplete
        ? "http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_green.png"
        : "http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png";
      return new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(24, 35));
    }

    function markComplete(idx, checkbox) {
      if (!checkbox.checked) return;
      completed[idx] = true;
      markers[idx].setImage(createMarkerImage(true));
      moveToNextIncomplete();
    }

    function moveToNextIncomplete() {
      for (let i = 0; i < markers.length; i++) {
        if (!completed[i]) {
          map.panTo(markers[i].getPosition());
          return;
        }
      }
      alert("🎉 모든 지점을 완료했습니다!");
    }

    function goToMyLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          myLocation = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
          map.setCenter(myLocation);
        }, () => {
          alert("위치 정보를 가져올 수 없습니다.");
        });
      } else {
        alert("이 브라우저는 위치 정보를 지원하지 않습니다.");
      }
    }
  </script>
</body>
</html>
